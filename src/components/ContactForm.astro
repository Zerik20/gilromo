---
interface Props {
  sectionId?: string
  title?: string
  subtitle?: string
  action?: string
  method?: 'POST' | 'GET'
}

const {
  sectionId = 'contacto-form',
  title = 'Regístrate ahora',
  subtitle = 'Para que no te quedes fuera de nuestro gran evento en Mérida, Yucatán.',
  action = 'https://script.google.com/macros/s/AKfycbzLTcsFDhzTV2sVlsKvPyC7490_VO3CcqrEvCcaVlfDadG0t0QXGDmlPayK0DaBCjiXqg/exec',
  method = 'POST',
} = Astro.props;
---

<section id={sectionId} class="relative py-16 sm:py-24" data-aos="fade-up">
  <div class="mx-auto w-full max-w-[900px] px-4 sm:px-6">
    <header class="mb-6 sm:mb-8 text-center max-w-3xl mx-auto" data-aos="fade-up">
      <h2 class="font-['Playfair_Display'] text-white font-semibold leading-tight text-[clamp(2rem,5vw,3rem)]">
        {title}
      </h2>
      <p class="mt-2 text-[var(--muted)]">{subtitle}</p>
    </header>

    <!-- Tarjeta del formulario -->
    <div class="rounded-2xl bg-black/50 ring-1 ring-white/10 p-5 sm:p-7 lg:p-8 backdrop-blur shadow-[0_18px_50px_rgba(0,0,0,.45)]" data-aos="fade-up" data-aos-delay="200">
      <!-- Grid simétrico 12 cols, centrado -->
      <form
        id="inscripcionForm"
        action={action || undefined}
        method={method}
        class="grid grid-cols-12 gap-4 place-items-center"
        data-aos="fade-up"
        data-aos-delay="220"
      >
        <!-- Nombre -->
        <div class="col-span-12 sm:col-span-6 w-full max-w-md" data-aos="fade-up" data-aos-delay="240">
          <label for="nombre" class="block text-sm font-medium text-white/90 text-center">Nombre</label>
          <input
            id="nombre" name="nombre" type="text" required autocapitalize="words" autocomplete="name"
            class="mt-1 w-full rounded-xl bg-white/5 text-white placeholder-white/40 border border-white/10
                   focus:border-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-400 px-3 py-2"
            placeholder="Tu nombre completo" />
        </div>

        <!-- Correo -->
        <div class="col-span-12 sm:col-span-6 w-full max-w-md" data-aos="fade-up" data-aos-delay="260">
          <label for="correo" class="block text-sm font-medium text-white/90 text-center">Correo</label>
          <input
            id="correo" name="correo" type="email" required autocomplete="email"
            class="mt-1 w-full rounded-xl bg-white/5 text-white placeholder-white/40 border border-white/10
                   focus:border-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-400 px-3 py-2"
            placeholder="tunombre@correo.com" />
        </div>

        <!-- Teléfono -->
        <div class="col-span-12 sm:col-span-6 w-full max-w-md" data-aos="fade-up" data-aos-delay="280" >
          <label for="telefono" class="block text-sm font-medium text-white/90 text-center">Teléfono</label>
          <input 
            id="telefono" name="telefono" type="tel" inputmode="tel" pattern="[0-9+() -]{6,}" required autocomplete="tel"
            class="mt-1 w-full rounded-xl bg-white/5 text-white placeholder-white/40 border border-white/10
                   focus:border-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-400 px-3 py-2"
            placeholder="+52 999 251 8592" />
        </div>

        <!-- Hidden: Estatus y metadatos -->
        <input type="hidden" name="estatus" value="Sin contactar" />
        <input type="hidden" name="estatus_color" value="#F59E0B" />
        <input type="hidden" name="lead_name" value="Cumbre Mérida 15 Nov Gil Romo" />
        <input type="hidden" name="empresa" value="Gil Romo Team" />

        <!-- CTA -->
        <div class="col-span-12 pt-2 flex justify-center items-center gap-4" data-aos="zoom-in" data-aos-delay="340">
          <button id="submitBtn" type="submit"
            class="btn-gold px-5 py-2.5 text-base rounded-full ring-2 ring-gold-300
                   hover:scale-[1.02] active:scale-[.98] transition">
            Enviar
          </button>
          <div id="loader" class="hidden">
            <span class="inline-block border-4 border-gold-400 border-t-transparent rounded-full w-7 h-7 animate-spin"></span>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- JS de envío (sin TS assertions) -->
  <script type="module">
    const formEl = document.getElementById('inscripcionForm');
    const submitBtn = document.getElementById('submitBtn');
    const loader = document.getElementById('loader');

    if (formEl) {
      formEl.addEventListener('submit', async (e) => {
        if (!formEl.action) return; // sin action, submit nativo
        e.preventDefault();

        if (loader) loader.classList.remove('hidden');
        if (submitBtn) { submitBtn.setAttribute('disabled', 'true'); submitBtn.textContent = 'Enviando…'; }

        try {
          const formData = new FormData(formEl);
          const resp = await fetch(formEl.action, { method: formEl.method || 'POST', body: formData });

          if (resp.ok) {
            if (typeof window !== 'undefined' && typeof window.fbq === 'function') { try { window.fbq('track', 'Lead'); } catch {} }
            window.location.href = '/gracias';
          } else {
            alert('Ocurrió un error al enviar el formulario.');
          }
        } catch {
          alert('No se pudo enviar. Intenta más tarde.');
        } finally {
          if (loader) loader.classList.add('hidden');
          if (submitBtn) { submitBtn.removeAttribute('disabled'); submitBtn.textContent = 'Enviar'; }
        }
      });
    }
  </script>
</section>
